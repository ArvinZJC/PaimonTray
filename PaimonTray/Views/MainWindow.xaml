<Window
    mc:Ignorable="d"
    x:Class="PaimonTray.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:h="using:PaimonTray.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ni="using:H.NotifyIcon"
    xmlns:vm="using:PaimonTray.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <!-- The root grid. -->
    <Grid
        Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
        Loaded="GridRoot_OnLoaded">
        <Grid.DataContext>
            <vm:CommandsViewModel x:Name="CommandsViewModel" />
        </Grid.DataContext>
        <!-- The app's task bar icon. -->
        <!-- TODO: ContextMenuMode="SecondWindow" if qualified. -->
        <ni:TaskbarIcon
            x:Name="TaskbarIconApp"
            LeftClickCommand="{x:Bind CommandsViewModel.ToggleMainWindowVisibilityCommand}"
            IconSource="{x:Bind h:AppConstantsHelper.UriAppIcon}"
            MenuActivation="RightClick"
            NoLeftClickDelay="True"
            Visibility="Collapsed">
            <ni:TaskbarIcon.ContextFlyout>
                <MenuFlyout AreOpenCloseAnimationsEnabled="False">
                    <MenuFlyoutItem Command="{x:Bind CommandsViewModel.AddAccountCommand}" />
                    <MenuFlyoutSeparator />
                    <MenuFlyoutItem Command="{x:Bind CommandsViewModel.ShowSettingsWindowCommand}" />
                    <MenuFlyoutSeparator />
                    <MenuFlyoutItem
                        x:FieldModifier="public"
                        x:Name="MenuFlyoutItemAppMenuMainWindowVisibility"
                        Command="{x:Bind CommandsViewModel.ToggleMainWindowVisibilityCommand}" />
                    <MenuFlyoutItem
                        Command="{x:Bind CommandsViewModel.ExitAppCommand}"
                        CommandParameter="{x:Bind TaskbarIconApp}" />
                </MenuFlyout>
            </ni:TaskbarIcon.ContextFlyout>
        </ni:TaskbarIcon>
        <!-- The body navigation view. -->
        <NavigationView
            x:FieldModifier="public"
            x:Name="NavigationViewBody"
            IsBackButtonVisible="Collapsed"
            IsPaneToggleButtonVisible="False"
            IsSettingsVisible="False"
            IsTabStop="False"
            PaneDisplayMode="{x:Bind MainWinViewModel.NavViewPaneDisplayMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            SelectionChanged="NavigationViewBody_OnSelectionChanged">
            <NavigationView.MenuItems>
                <NavigationViewItem
                    x:Name="NavigationViewItemBodyAddAccount"
                    Icon="Add"
                    Tag="{x:Bind h:AccountsHelper.TagAddAccount}" />
            </NavigationView.MenuItems>
            <NavigationView.PaneFooter>
                <!-- The main menu button. -->
                <Button
                    x:Name="ButtonMainMenu"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Margin="4, 0, 0, 0"
                    Padding="0, 7"
                    Width="40">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Command="{x:Bind CommandsViewModel.AddAccountCommand}" />
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Command="{x:Bind CommandsViewModel.ShowSettingsWindowCommand}" />
                            <MenuFlyoutSubItem
                                x:Name="MenuFlyoutSubItemMainMenuHelp"
                                Icon="Help">
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuHelpHome"
                                    Icon="Home"
                                    IsEnabled="False" />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuUserManual"
                                    IsEnabled="False">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="{x:Bind h:AppConstantsHelper.GlyphDictionary}" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuGitHubRepo"
                                    Command="{x:Bind CommandsViewModel.OpenLinkInDefaultCommand}"
                                    CommandParameter="{x:Bind h:AppConstantsHelper.UrlGitHubRepo}" />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuGiteeRepo"
                                    IsEnabled="False" />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuIssuesView"
                                    Command="{x:Bind CommandsViewModel.OpenLinkInDefaultCommand}"
                                    CommandParameter="{x:Bind h:AppConstantsHelper.UrlGitHubRepoIssues}" />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuReleaseNotes"
                                    Command="{x:Bind CommandsViewModel.OpenLinkInDefaultCommand}"
                                    CommandParameter="{x:Bind h:AppConstantsHelper.UrlGitHubRepoReleases}" />
                                <MenuFlyoutSeparator />
                                <MenuFlyoutItem
                                    x:Name="MenuFlyoutItemMainMenuHelpLogsShow"
                                    Command="{x:Bind CommandsViewModel.OpenLinkInDefaultCommand}" />
                            </MenuFlyoutSubItem>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem
                                x:Name="MenuFlyoutItemMainMenuMainWindowHide"
                                Command="{x:Bind CommandsViewModel.ToggleMainWindowVisibilityCommand}" />
                            <MenuFlyoutItem
                                Command="{x:Bind CommandsViewModel.ExitAppCommand}"
                                CommandParameter="{x:Bind TaskbarIconApp}" />
                        </MenuFlyout>
                    </Button.Flyout>
                    <SymbolIcon Symbol="More" />
                </Button>
            </NavigationView.PaneFooter>
            <!-- The body frame. -->
            <Frame
                x:FieldModifier="public"
                x:Name="FrameBody"
                HorizontalAlignment="Left"
                IsNavigationStackEnabled="False"
                SizeChanged="FrameBody_OnSizeChanged"
                VerticalAlignment="Top" />
        </NavigationView>
    </Grid>
</Window>