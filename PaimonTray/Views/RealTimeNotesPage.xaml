<Page
    mc:Ignorable="d"
    x:Class="PaimonTray.Views.RealTimeNotesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:c="using:PaimonTray.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:h="using:PaimonTray.Helpers"
    xmlns:m="using:PaimonTray.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Page.Resources>
        <!-- Put converters here to make them work with x:Bind. Reference: https://github.com/microsoft/microsoft-ui-xaml/issues/3442#issuecomment-772898950 -->
        <c:GroupInfoListKeyConverter x:Key="GroupInfoListKeyConverter" />
    </Page.Resources>
    <!-- The root grid. -->
    <Grid Loaded="GridRoot_OnLoaded">
        <!-- The body scroll viewer. -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <!-- The body grid. -->
            <Grid
                x:Name="GridBody"
                HorizontalAlignment="Left"
                Padding="12"
                RowSpacing="8"
                SizeChanged="GridBody_OnSizeChanged"
                VerticalAlignment="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <!-- The title text block. -->
                <TextBlock
                    x:Name="TextBlockTitle"
                    Grid.Row="0"
                    Style="{ThemeResource SubtitleTextBlockStyle}" />
                <!-- The content stack panel. -->
                <StackPanel Grid.Row="1">
                    <!-- The character grid. -->
                    <Grid
                        Background="{ThemeResource ExpanderHeaderBackground}"
                        BorderBrush="{ThemeResource ExpanderHeaderBorderBrush}"
                        BorderThickness="{ThemeResource ExpanderHeaderBorderThickness}"
                        ColumnSpacing="32"
                        CornerRadius="4, 4, 0, 0"
                        Padding="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Text="In progress: character" />
                        <Button
                            Grid.Column="1"
                            Padding="4">
                            <Button.Flyout>
                                <!-- The grouped characters flyout. -->
                                <Flyout>
                                    <ListView
                                        x:Name="ListViewGroupedCharacters"
                                        HorizontalAlignment="Stretch"
                                        ItemsSource="{x:Bind CollectionViewSourceGroupedCharacters.View, Mode=OneWay}"
                                        Margin="-12"
                                        SelectionChanged="ListViewGroupedCharacters_OnSelectionChanged">
                                        <ListView.GroupStyle>
                                            <GroupStyle>
                                                <GroupStyle.HeaderTemplate>
                                                    <DataTemplate x:DataType="m:GroupInfoList">
                                                        <Grid
                                                            ColumnSpacing="12"
                                                            Margin="0, 4, 0, 0">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="*" />
                                                            </Grid.ColumnDefinitions>
                                                            <PersonPicture
                                                                Grid.Column="0"
                                                                Grid.Row="0"
                                                                Grid.RowSpan="2"
                                                                Height="32"
                                                                Width="32">
                                                                <PersonPicture.ProfilePicture>
                                                                    <BitmapImage
                                                                        DecodePixelHeight="32"
                                                                        UriSource="{x:Bind Key, Converter={StaticResource GroupInfoListKeyConverter}, ConverterParameter=avatar}" />
                                                                </PersonPicture.ProfilePicture>
                                                            </PersonPicture>
                                                            <TextBlock
                                                                Grid.Column="1"
                                                                Grid.Row="0"
                                                                Style="{ThemeResource BaseTextBlockStyle}"
                                                                Text="{x:Bind Key, Converter={StaticResource GroupInfoListKeyConverter}, ConverterParameter=aNickname}" />
                                                            <TextBlock
                                                                Foreground="{ThemeResource SystemControlPageTextBaseMediumBrush}"
                                                                Grid.Column="1"
                                                                Grid.Row="1"
                                                                Style="{ThemeResource BodyTextBlockStyle}"
                                                                Text="{x:Bind Key, Converter={StaticResource GroupInfoListKeyConverter}, ConverterParameter=aOtherInfo}" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </GroupStyle.HeaderTemplate>
                                            </GroupStyle>
                                        </ListView.GroupStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="m:AccountCharacter">
                                                <ListViewItem IsEnabled="True">
                                                    <Grid Padding="0, 8">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                        </Grid.RowDefinitions>
                                                        <TextBlock
                                                            Grid.Row="0"
                                                            Style="{ThemeResource BaseTextBlockStyle}"
                                                            Text="{x:Bind CNickname}" />
                                                        <TextBlock
                                                            Foreground="{ThemeResource SystemControlPageTextBaseMediumBrush}"
                                                            Grid.Row="1"
                                                            Style="{ThemeResource BodyTextBlockStyle}">
                                                            <Run Text="{x:Bind Region}" />
                                                            |
                                                            <Run Text="{x:Bind Level}" />
                                                            |
                                                            <Run Text="{x:Bind CUid}" />
                                                        </TextBlock>
                                                    </Grid>
                                                </ListViewItem>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <ListView.Resources>
                                            <CollectionViewSource
                                                x:Name="CollectionViewSourceGroupedCharacters"
                                                IsSourceGrouped="True" />
                                        </ListView.Resources>
                                    </ListView>
                                </Flyout>
                            </Button.Flyout>
                            <FontIcon Glyph="{x:Bind h:AppConstantsHelper.GlyphSwitchUser}" />
                        </Button>
                    </Grid>
                    <!-- The character's real-time notes grid. -->
                    <Grid
                        Background="{ThemeResource ExpanderContentBackground}"
                        BorderBrush="{ThemeResource ExpanderContentBorderBrush}"
                        BorderThickness="{ThemeResource ExpanderContentDownBorderThickness}"
                        CornerRadius="0, 0, 4, 4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ListView SelectionMode="Single">
                            <ListViewHeaderItem Content="Current Resin" />
                            <ListViewItem Content="160/160" />
                            <ListViewItem Content="Fully replenished                 0m" />
                            <ListViewItem Content="ETA Today                      10.51" />
                            <MenuFlyoutSeparator />
                            <ListViewHeaderItem Content="Expeditions 5/5" />
                            <ListViewItem Content="Complete                          0m" />
                            <ListViewItem Content="Complete                          0m" />
                            <ListViewItem Content="Complete                          0m" />
                            <ListViewItem Content="Complete                          0m" />
                            <ListViewItem Content="Complete                          0m" />
                            <MenuFlyoutSeparator />
                            <ListViewItem Content="Daily commissions                0/4" />
                            <ListViewItem Content="Realm currency             2400/2400" />
                            <ListViewItem Content="Weekly bosses                    3/3" />
                            <ListViewItem Content="Parametric Transformer             √" />
                        </ListView>
                    </Grid>
                </StackPanel>
            </Grid>
        </ScrollViewer>
        <!-- The status grid. -->
        <Grid
            x:Name="GridStatus"
            Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
            Padding="12">
            <Grid
                ColumnSpacing="12"
                HorizontalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid
                    x:Name="GridStatusWarning"
                    Grid.Column="0"
                    Visibility="Collapsed">
                    <FontIcon
                        Foreground="{ThemeResource InfoBarWarningSeverityIconBackground}"
                        Glyph="{ThemeResource InfoBarIconBackgroundGlyph}" />
                    <FontIcon
                        Foreground="{ThemeResource InfoBarWarningSeverityIconForeground}"
                        Glyph="{ThemeResource InfoBarWarningIconGlyph}" />
                </Grid>
                <ProgressRing
                    x:Name="ProgressRingStatusLoading"
                    Grid.Column="0"
                    IsActive="True" />
                <TextBlock
                    x:Name="TextBlockStatus"
                    Grid.Column="1"
                    TextWrapping="WrapWholeWords"
                    VerticalAlignment="Center" />
            </Grid>
        </Grid>
    </Grid>
</Page>